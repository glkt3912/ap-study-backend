// Prisma Schema - データベース設計
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 学習週モデル
model StudyWeek {
  id         Int      @id @default(autoincrement())
  weekNumber Int      @unique
  title      String
  phase      String
  goals      String // JSON配列として保存
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // リレーション
  days StudyDay[]

  @@map("study_weeks")
}

// 学習日モデル  
model StudyDay {
  id            Int      @id @default(autoincrement())
  day           String // 月、火、水...
  subject       String
  topics        String // JSON配列として保存
  estimatedTime Int // 分
  actualTime    Int      @default(0)
  completed     Boolean  @default(false)
  understanding Int      @default(0) // 1-5
  memo          String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // 外部キー
  weekId Int
  week   StudyWeek @relation(fields: [weekId], references: [id], onDelete: Cascade)

  @@map("study_days")
}

// 学習記録モデル
model StudyLog {
  id            Int      @id @default(autoincrement())
  date          DateTime
  subject       String
  topics        String // JSON配列として保存
  studyTime     Int // 分
  understanding Int // 1-5
  memo          String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("study_logs")
}

// 午前問題記録モデル
model MorningTest {
  id             Int      @id @default(autoincrement())
  date           DateTime
  category       String
  totalQuestions Int
  correctAnswers Int
  timeSpent      Int // 分
  memo           String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("morning_tests")
}

// 午後問題記録モデル
model AfternoonTest {
  id           Int      @id @default(autoincrement())
  date         DateTime
  category     String   // questionType → category に統一
  score        Int // 点数
  timeSpent    Int // 分
  memo         String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("afternoon_tests")
}

// 学習分析結果モデル
model AnalysisResult {
  id              Int      @id @default(autoincrement())
  userId          String?
  analysisDate    DateTime
  studyPattern    String   // JSON形式で保存
  weaknessAnalysis String  // JSON形式で保存
  studyRecommendation String // JSON形式で保存
  overallScore    Int      // 0-100
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("analysis_results")
}

// 予測結果モデル
model PredictionResult {
  id                Int      @id @default(autoincrement())
  userId            String?
  predictionDate    DateTime
  examDate          DateTime
  passProbability   String   // JSON形式で保存
  studyTimePrediction String // JSON形式で保存
  scorePrediction   String   // JSON形式で保存
  examReadiness     String   // JSON形式で保存
  modelVersion      String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("prediction_results")
}

// 復習項目モデル
model ReviewItem {
  id                    Int      @id @default(autoincrement())
  userId                String?
  subject               String
  topic                 String
  lastStudyDate         DateTime
  nextReviewDate        DateTime
  reviewCount           Int      @default(0)
  difficulty            Int      // 1-5
  understanding         Int      // 1-5
  priority              Int      // 0-100
  forgettingCurveStage  Int      @default(1) // 1-7
  intervalDays          Int      @default(1)
  isCompleted           Boolean  @default(false)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("review_items")
}

// 復習セッションモデル
model ReviewSession {
  id                   Int      @id @default(autoincrement())
  userId               String?
  sessionDate          DateTime
  totalItems           Int
  completedItems       Int      @default(0)
  sessionDuration      Int      // 分
  averageUnderstanding Float    @default(0)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@map("review_sessions")
}
